# CLAUDE AI AGENT - CONTEXT & INSTRUCTIONS

## Project Context
**Project:** Hệ thống Quản lý Lương (Payroll Management System)
**Current Phase:** Requirements Analysis → Design Phase Transition
**Status:** Requirements phase 100% complete, ready for Design phase
**Timeline:** 6 months to production
**Budget:** 500M VNĐ
**Team:** 5-7 people

## Current State Assessment
✅ **COMPLETED - Requirements Analysis Phase:**
- All 7 core documents finished (100% coverage)
- Business requirements documented
- Functional & non-functional requirements specified
- User stories with acceptance criteria
- Requirements traceability & prioritization matrices
- Prototype/mockup designs
- Data flow diagrams

🎯 **NEXT PHASE - Design Phase:**
According to `bo-tai-lieu-chuan-phat-trien-phan-mem.md`, design phase will include:
- Architecture Design Document
- Detailed Design Document
- Database Design Document
- API Design Specification
- UI/UX Design Document
- Security Design & Threat Model

## Working Principles for AI Agent

### MANDATORY COMPLIANCE:
📋 **MUST FOLLOW:** `bo-tai-lieu-chuan-phat-trien-phan-mem.md` document structure
- All documents MUST align with the standard template structure
- Document sequence MUST follow the defined phase order
- Document naming MUST follow the numbering convention

### STRICT CONSTRAINTS:
1. **DO NOT** create new documents outside the standard template
2. **DO NOT** generate content beyond existing structure
3. **DO NOT** add documents not in the official catalog
4. **ONLY** act on specific user requests
5. **FOLLOW** the software development standards strictly
6. **COMPLY** with document ordering in `bo-tai-lieu-chuan-phat-trien-phan-mem.md`

### APPROVED ACTIONS:
- ✅ Review and improve existing documents
- ✅ Help prepare for design phase transition
- ✅ Support requirements sign-off process
- ✅ Maintain documentation quality
- ✅ Answer questions about current documents
- ✅ Provide analysis of existing requirements
- ✅ Create documents ONLY when they match the standard template

### FORBIDDEN ACTIONS:
- ❌ Create additional .md files outside standard structure
- ❌ Add new sections not in templates
- ❌ Generate documentation outside scope
- ❌ Modify document structure/format from standard
- ❌ Add features not requested
- ❌ Deviate from the approved document sequence

## Document Structure Reference

### STANDARD DOCUMENT SEQUENCE (FROM bo-tai-lieu-chuan-phat-trien-phan-mem.md):

#### 📁 REQUIREMENTS PHASE (Phân tích Yêu cầu):
1. **Business Process Model** - Quy trình nghiệp vụ AS-IS/TO-BE
2. **Use Cases/User Stories** - Yêu cầu chức năng chi tiết
3. **ERD Conceptual** - Mô hình dữ liệu khái niệm
4. **Prototype/Mockup** - UI/UX ban đầu

#### 📁 DESIGN PHASE (Thiết kế):
5. **Architecture Design** - Kiến trúc tổng thể
6. **Class Diagram** - Thiết kế OOP
7. **Sequence Diagram** - Luồng xử lý
8. **ERD Detailed/Logical Data Model** - Database design chi tiết
9. **API Design** - Interface specifications

### NEW PHASE-BASED STRUCTURE (MANDATORY):
```
HRM/Payroll/
├── 1_PhanTichYeuCau/        ✅ COMPLETED (8 documents)
├── 2_ThietKe/               🎯 IN PROGRESS (8 documents)
├── 3_PhatTrien/             ⏳ WAITING
├── 4_KiemThu/               ⏳ WAITING
├── 5_TrienKhai/             ⏳ WAITING
└── 6_VanHanh/               ⏳ WAITING
```

### IMPORTANT RULES:
1. **Documents MUST be created in phase folders** (1_PhanTichYeuCau, 2_ThietKe, etc.)
2. **Each phase has its own README.md** with checklist and status
3. **Documents are numbered within each phase** (1_ArchitectureDesign.md, 2_DetailedDesign.md, etc.)
4. **NEVER create documents outside defined structure**
5. **ONLY create documents when explicitly requested**
6. **FOLLOW the exact sequence** defined in `bo-tai-lieu-chuan-phat-trien-phan-mem.md`

### Current Phase Documents:
```
2_ThietKe/                    🎯 Design Phase
├── README.md                 # Phase overview
├── 1_ArchitectureDesign.md  # Kiến trúc tổng thể
├── 2_DetailedDesign.md      # Class Diagram & detailed design
├── 3_DatabaseDesign.md      # ERD Detailed & Database schema
├── 4_APIDesign.md           # API specifications
├── 5_UIUXDesign.md          # UI/UX detailed design
├── 6_SecurityDesign.md      # Security architecture
├── 7_IntegrationDesign.md   # Integration patterns
└── 8_PrivacyAssessment.md   # Privacy compliance
```

### Standards Reference:
- `bo-tai-lieu-chuan-phat-trien-phan-mem.md` - Master software development standards
- Follows IEEE, CMMI, ISO standards
- 95% coverage for all project types
- Scalable by methodology (Agile/Waterfall/DevOps)

## Key Project Information

### System Scope:
- Automated payroll calculation
- Multiple salary structure management
- Tax & social insurance calculation (Vietnam law)
- Employment contract management
- Salary history tracking

### Target Users:
- HR Staff: Employee management, payroll processing
- Accountant: Payment processing, financial reports
- Manager: Approval workflows, reports
- Employee: Personal payroll viewing

### Technical Constraints:
- Browser compatibility: Last 2 years
- Vietnam labor law compliance required
- Cloud-based deployment expected
- Integration with existing attendance system

### Stakeholders:
- Business Owner: Business process approval
- Product Owner: Requirements & priority management
- Tech Lead: Technical architecture & feasibility
- QA Lead: Test planning & acceptance criteria
- Dev Team: Implementation & estimation

## Current Tasks & Priorities

### Phase Transition Tasks:
1. Requirements review completion (1 week)
2. Stakeholder feedback incorporation (3 days)
3. Requirements sign-off (2 days)
4. Design phase kickoff preparation

### Quality Gates:
- All requirements documents reviewed ✅
- Business process validated ✅
- Technical feasibility confirmed ✅
- Priorities agreed by stakeholders ✅
- Ready for design phase ✅

## Agent Response Guidelines

### When User Asks to:
**"Create new document"** → Explain constraint, offer to help with existing docs
**"Add new section"** → Check if within existing template, otherwise decline politely
**"Modify requirements"** → Help with change control process, document updates
**"Review document"** → Provide thorough analysis and improvement suggestions
**"Prepare for design"** → Help organize transition activities within scope

### Response Format:
- Be concise and direct
- Reference specific documents and line numbers when relevant
- Focus on actionable insights
- Maintain professional technical tone
- Respect the established documentation structure

## HTML Prototype Development - MANDATORY REQUIREMENTS

### ALWAYS Read Design Standards BEFORE Creating HTML Prototypes

**⚠️ CRITICAL RULE:** Before creating any HTML prototype, you MUST read and follow:

1. **`BFDocs/UI_UX_Design_Standards.md`** - Master UI/UX design standards
   - Layout patterns (sidebar navigation, main content structure)
   - Color palette and visual identity
   - Form patterns and validation
   - Button styles and action patterns
   - Status badges and indicators
   - Table layouts and data display
   - Modal patterns
   - Responsive design guidelines

2. **Key Requirements for HTML Prototypes:**
   - ✅ **MUST** use Bootstrap 5.3
   - ✅ **MUST** follow color palette from design standards
   - ✅ **MUST** use standard layout (top header + sidebar navigation + main content)
   - ✅ **MUST** implement action buttons with consistent styles (Edit, Deactivate, Delete)
   - ✅ **MUST** use Bootstrap badge components for status indicators
   - ⚠️ **Sidebar is OPTIONAL** - Dev can remove it (application already has sidebar)
   - ⚠️ **Main Content** is what dev needs - keep it self-contained in `<div class="main-container">`

3. **🆕 Shared Sidebar Component (RECOMMENDED):**
   - **Location:** `BFDocs/Finance/sidebar.js`
   - **Use shared sidebar JavaScript file** instead of copying sidebar code to each prototype
   - **Benefits:** Single source of truth, easier maintenance, consistent navigation, works with local file:// protocol (no CORS issues)
   - **How to use:**
     ```html
     <!-- Add sidebar container -->
     <div id="sidebar-container"></div>

     <!-- Load shared sidebar -->
     <script src="../../../sidebar.js"></script>
     <script>
         window.SIDEBAR_BASE_PATH = '../../../'; // Adjust based on location
         if (document.readyState === 'loading') {
             document.addEventListener('DOMContentLoaded', renderSidebar);
         } else {
             renderSidebar();
         }
     </script>
     ```
   - Sidebar automatically highlights active page and opens parent submenu
   - All navigation links work between prototypes
   - Mobile-responsive with hamburger menu
   - Works when opening HTML files directly (no web server required)

4. **When Creating New Finance Module Prototypes:**
   ```
   Step 1: Read BFDocs/UI_UX_Design_Standards.md
   Step 2: Use shared sidebar component (BFDocs/Finance/sidebar.js)
   Step 3: Add sidebar container div + include sidebar.js + call renderSidebar()
   Step 4: Create main content following design patterns
   Step 5: Test responsive layout
   Step 6: Verify sidebar navigation works correctly
   Step 7: Test by opening HTML file directly in browser (file:// protocol)
   ```

5. **Reference Implementations:**
   - **Shared Sidebar Component:** `BFDocs/Finance/sidebar.js` - Use this for all Finance prototypes
   - **Good Examples:** `BFDocs/Finance/Dimension/2_ThietKe/html-prototypes/`
     - `1_dimension-definition.html` - Full ERP layout with shared sidebar
     - `2_dimension-values.html` - Tree view pattern with shared sidebar
     - `3_account-dimension-mapping.html` - Configuration screen pattern with shared sidebar
   - **Good Example:** `BFDocs/Finance/Cashin-out/2_ThietKe/html-prototypes/2_create-cashin.html` - Form with shared sidebar
   - **Patterns to Follow:** Shared sidebar component, action buttons, status badges, modal patterns, form validation

---

## Prototype Coding Standards (CashIn Form)

### NUMBER FORMAT RULES - MANDATORY
**Rule: MUST be consistent - no mixing comma & dot**

**Display Numbers (HTML/UI):**
- Format: `10,000,000 VNĐ` (comma separator)
- Use `new Intl.NumberFormat('vi-VN').format(value)` for formatting
- Example: `<td class="text-end">25,000,000</td>`

**Data Attributes (HTML):**
- Format: `data-available="8000000"` (NO separator, plain integer)
- Example: `<input data-available="8000000">`

**JavaScript Parsing:**
- Remove comma: `.replace(/,/g, '')`
- Parse to integer: `parseInt(cleanValue)`
- Example: `const value = parseInt(input.value.replace(/,/g, '')) || 0;`

**FORBIDDEN - NEVER DO:**
- ❌ `10.000.000` (dot separator - European format)
- ❌ `data-available="10,000,000"` (comma in data attribute)
- ❌ `parseInt("10,000,000")` (direct parse with comma)

### VALIDATION PATTERN - MUST USE
**Pattern for reconcile/installment inputs:**
```javascript
// Validate input and show error if exceeds balance
function validateInput(input) {
    const balance = parseInt(input.getAttribute('data-balance')) || 0;
    const cleanValue = (input.value || '').toString().replace(/,/g, '');
    const enteredValue = parseInt(cleanValue) || 0;

    const errorContainer = input.closest('div').querySelector('.error-element');
    if (enteredValue > balance) {
        // Show error - don't auto-fix
        errorContainer.style.display = 'block';
        input.style.borderColor = '#dc3545';
    } else {
        // Clear error
        errorContainer.style.display = 'none';
        input.style.borderColor = '';
    }
}
```

### KEY PRINCIPLES FOR AGENT
1. **NEVER add validation logic without explicit user request**
2. **Keep validation SIMPLE - show error, don't auto-fix**
3. **Always reference existing working patterns** before adding new code
4. **Follow the simplest working pattern** (look at Payment modal as reference)
5. **When in doubt, ask user for clarification** before coding

## Success Metrics
- Documentation completeness: 100% ✅
- Stakeholder alignment: In progress
- Design readiness: Target achieved
- Quality compliance: Standards followed ✅

## CRITICAL BUSINESS RULES - VIETNAM PAYROLL

### Quy định tính Thuế TNCN (MANDATORY COMPLIANCE)

**ĐÚNG - Logic tính thuế theo Luật Việt Nam:**
```
Thu nhập chịu thuế = Thu nhập GROSS - BHXH cá nhân - Giảm trừ
```

**Trong đó:**
- **Thu nhập GROSS** = Lương cơ bản + Phụ cấp chịu thuế (TRƯỚC khi trừ BHXH)
- **BHXH cá nhân** = 8% lương đóng BHXH (được trừ TRƯỚC khi tính thuế)
- **Giảm trừ cá nhân** = 11,000,000 VNĐ/tháng (2024)
- **Giảm trừ người phụ thuộc** = 4,400,000 VNĐ/người/tháng

**SAI - Lỗi phổ biến cần tránh:**
- ❌ Tính thuế từ lương NET (sau khi trừ BHXH)
- ❌ Quên trừ BHXH trước khi tính thuế
- ❌ Nhầm lẫn giữa GROSS và NET income

### Data Flow cho Process 3.5 (Calculate Tax):
```
Inputs:
- P32 → Gross salary (KHÔNG PHẢI NET)
- P33 → Tax exempt allowances
- P34 → BHXH deductions (để trừ trước khi tính thuế)
- D1 → Dependents info
- D4 → Tax rules & rates
```

### Compliance References:
- Luật Thuế TNCN số 04/2007/QH12
- Thông tư 111/2013/TT-BTC
- Cập nhật mức giảm trừ 2024

**IMPORTANT:** Tất cả tài liệu liên quan đến tính lương PHẢI tuân thủ logic này.

---
**Agent Version:** 1.3.1
**Context Updated:** 2025-10-31
**Scope:** Requirements → Design Transition Support + HTML Prototype Development
**Compliance:** Vietnam Tax Law Mandatory + UI/UX Design Standards Mandatory
**New in 1.3.1:** Shared Sidebar Component migrated from `sidebar.html` to `sidebar.js` - Works with local file:// protocol, no CORS issues